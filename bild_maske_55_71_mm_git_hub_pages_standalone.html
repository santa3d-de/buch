<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bild‑Masken 55×71 mm, 71×33 mm & 33×71 mm – Export PNG/PDF</title>
  <meta name="description" content="Bild in mehreren mm-Rahmen laden, verschieben/zoomen und als PNG oder PDF exportieren. Perfekt für GitHub Pages (keine Build-Tools)." />
  <style>
    :root { --bg:#f7f7f8; --fg:#111; --muted:#666; --card:#fff; --border:#dcdcdc; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--fg); }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    h1 { font-size: 22px; margin: 0 0 8px; }
    p.lead { color: var(--muted); font-size: 14px; margin: 0 0 24px; }
    .grid { display: grid; grid-template-columns: 300px 1fr; gap: 16px; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .label { font-size: 12px; font-weight: 600; display: block; margin-bottom: 6px; }
    input[type="file"] { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: #fff; }
    .row { display: flex; gap: 8px; align-items: center; }
    .row + .row { margin-top: 8px; }
    .btn { appearance: none; border: 1px solid var(--border); background: #fff; padding: 10px 12px; border-radius: 10px; cursor: pointer; font-size: 14px; }
    .btn:hover { background: #f2f2f2; }
    .btn:active { transform: translateY(1px); }
    .hint { color: var(--muted); font-size: 12px; }
    .frameList { display: grid; gap: 16px; }
    .frameTitle { font-size: 13px; font-weight: 600; margin-bottom: 8px; }
    .previewShell { border: 1px solid var(--border); margin: 0 auto; position: relative; overflow: hidden; background:#fff; border-radius: 10px; }
    canvas { position:absolute; inset:0; width:100%; height:100%; }
    .drop { position:absolute; inset:0; display:grid; place-content:center; color:#777; font-size: 13px; text-align:center; padding: 0 12px; }
    .controlBlock { margin-top: 12px; }
    .buttonRow { flex-wrap: wrap; justify-content: flex-start; margin-top: 12px; }
    .buttonRow .btn { flex: 1 1 140px; }
  </style>
  <!-- jsPDF für PDF-Export (CDN) -->
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>Bild‑Masken 55×71 mm, 71×33 mm & 33×71 mm</h1>
    <p class="lead">Bild hochladen, im gewünschten Millimeter-Rahmen verschieben/zoomen und als <strong>PDF</strong> (millimetergenau) oder <strong>PNG</strong> exportieren. Jeder Rahmen merkt sich eigene Position und Zoom. Beim Drucken in 100 % / „Tatsächliche Größe“ ohne „An Seite anpassen“ drucken.</p>

    <div class="grid">
      <!-- Linke Spalte: Steuerung -->
      <div class="card">
        <label class="label">Bild wählen</label>
        <input id="fileInput" type="file" accept="image/*" />
        <p class="hint" style="margin-top:12px">Tipp: Bild in der Vorschau anklicken und ziehen (auch Touch). Mit dem Mausrad zoomst du jeweils um den Zeiger herum.</p>
        <button id="exportAllPdf" class="btn" style="width:100%; margin-top:16px;" disabled>Alle 3 Masken als eine PDF exportieren</button>
      </div>

      <!-- Rechte Spalte: Vorschauen -->
      <div class="frameList">
        <div class="card frameCard">
          <div class="frameTitle">Vorschau 55×71 mm (Hochformat)</div>
          <div id="preview-55x71" class="previewShell" style="width:55mm; height:71mm;">
            <canvas id="canvas-55x71"></canvas>
            <label for="fileInput" id="dropHint-55x71" class="drop">Bild hierher ziehen oder klicken</label>
          </div>
          <div class="controlBlock">
            <div class="row" style="justify-content:space-between;">
              <span class="label" style="margin:0">Zoom</span>
              <span class="hint" id="zoomLabel-55x71">1.00×</span>
            </div>
            <input id="zoom-55x71" type="range" min="0.1" max="5" step="0.005" value="1" style="width:100%" />
          </div>
          <div class="row buttonRow">
            <button class="btn" data-frame="55x71" data-action="reset">Zurücksetzen</button>
            <button class="btn" data-frame="55x71" data-action="png">PNG exportieren</button>
          </div>
        </div>

        <div class="card frameCard">
          <div class="frameTitle">Vorschau 71×33 mm (Querformat)</div>
          <div id="preview-71x33" class="previewShell" style="width:71mm; height:33mm;">
            <canvas id="canvas-71x33"></canvas>
            <label for="fileInput" id="dropHint-71x33" class="drop">Bild hierher ziehen oder klicken</label>
          </div>
          <div class="controlBlock">
            <div class="row" style="justify-content:space-between;">
              <span class="label" style="margin:0">Zoom</span>
              <span class="hint" id="zoomLabel-71x33">1.00×</span>
            </div>
            <input id="zoom-71x33" type="range" min="0.1" max="5" step="0.005" value="1" style="width:100%" />
          </div>
          <div class="row buttonRow">
            <button class="btn" data-frame="71x33" data-action="reset">Zurücksetzen</button>
            <button class="btn" data-frame="71x33" data-action="png">PNG exportieren</button>
          </div>
        </div>

        <div class="card frameCard">
          <div class="frameTitle">Vorschau 33×71 mm (Hochformat schmal)</div>
          <div id="preview-33x71" class="previewShell" style="width:33mm; height:71mm;">
            <canvas id="canvas-33x71"></canvas>
            <label for="fileInput" id="dropHint-33x71" class="drop">Bild hierher ziehen oder klicken</label>
          </div>
          <div class="controlBlock">
            <div class="row" style="justify-content:space-between;">
              <span class="label" style="margin:0">Zoom</span>
              <span class="hint" id="zoomLabel-33x71">1.00×</span>
            </div>
            <input id="zoom-33x71" type="range" min="0.1" max="5" step="0.005" value="1" style="width:100%" />
          </div>
          <div class="row buttonRow">
            <button class="btn" data-frame="33x71" data-action="reset">Zurücksetzen</button>
            <button class="btn" data-frame="33x71" data-action="png">PNG exportieren</button>
          </div>
        </div>
      </div>
    </div>

    <p class="hint" style="margin-top:16px">Quelle: Single‑File ohne Build‑Schritt – ideal für GitHub Pages. Nur diese <code>index.html</code> hochladen.</p>
  </div>

  <script>
    const dpi = 300;
    const mmToInch = (mm) => mm / 25.4;
    const frames = [
      { key: '55x71', mm: { w: 55, h: 71 } },
      { key: '71x33', mm: { w: 71, h: 33 } },
      { key: '33x71', mm: { w: 33, h: 71 } }
    ];

    const fileInput = document.getElementById('fileInput');
    const exportAllPdfBtn = document.getElementById('exportAllPdf');

    const frameStates = frames.map(({ key, mm }) => {
      const preview = document.getElementById(`preview-${key}`);
      const canvas = document.getElementById(`canvas-${key}`);
      const ctx = canvas.getContext('2d');
      const zoom = document.getElementById(`zoom-${key}`);
      const zoomLabel = document.getElementById(`zoomLabel-${key}`);
      const dropHint = document.getElementById(`dropHint-${key}`);
      const resetBtn = document.querySelector(`button[data-frame="${key}"][data-action="reset"]`);
      const exportPngBtn = document.querySelector(`button[data-frame="${key}"][data-action="png"]`);
      const px = {
        w: Math.round(mmToInch(mm.w) * dpi),
        h: Math.round(mmToInch(mm.h) * dpi)
      };
      canvas.width = px.w;
      canvas.height = px.h;

      const state = {
        key,
        mm,
        px,
        preview,
        canvas,
        ctx,
        zoom,
        zoomLabel,
        dropHint,
        resetBtn,
        exportPngBtn,
        offsetX: 0,
        offsetY: 0,
        scale: 1,
        coverScale: 1,
        dragging: false,
        startX: 0,
        startY: 0,
        startOX: 0,
        startOY: 0
      };

      const getLocalPoint = (evt) => {
        const rect = preview.getBoundingClientRect();
        const point = evt.touches ? evt.touches[0] : evt;
        const ratioX = canvas.width / rect.width;
        const ratioY = canvas.height / rect.height;
        return {
          x: (point.clientX - rect.left - rect.width / 2) * ratioX,
          y: (point.clientY - rect.top - rect.height / 2) * ratioY
        };
      };

      const onDown = (evt) => {
        if (!img) return;
        state.dragging = true;
        const p = getLocalPoint(evt);
        state.startX = p.x;
        state.startY = p.y;
        state.startOX = state.offsetX;
        state.startOY = state.offsetY;
        evt.preventDefault();
      };
      const onMove = (evt) => {
        if (!state.dragging) return;
        const p = getLocalPoint(evt);
        state.offsetX = state.startOX + (p.x - state.startX);
        state.offsetY = state.startOY + (p.y - state.startY);
        evt.preventDefault();
        drawFrame(state);
      };
      const onUp = () => { state.dragging = false; };

      preview.addEventListener('mousedown', onDown);
      window.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onUp);
      preview.addEventListener('touchstart', onDown, { passive: false });
      window.addEventListener('touchmove', onMove, { passive: false });
      window.addEventListener('touchend', onUp);

      zoom.addEventListener('input', () => {
        setScale(state, parseFloat(zoom.value));
        drawFrame(state);
      });

      preview.addEventListener('wheel', (evt) => {
        if (!img) return;
        evt.preventDefault();
        const factor = evt.deltaY > 0 ? 0.9 : 1.1;
        const rect = preview.getBoundingClientRect();
        const pointerX = (evt.clientX - rect.left - rect.width / 2) * (canvas.width / rect.width);
        const pointerY = (evt.clientY - rect.top - rect.height / 2) * (canvas.height / rect.height);
        const prevScale = state.scale;
        const imageRelX = (pointerX - state.offsetX) / prevScale;
        const imageRelY = (pointerY - state.offsetY) / prevScale;
        setScale(state, state.scale * factor);
        state.offsetX = pointerX - imageRelX * state.scale;
        state.offsetY = pointerY - imageRelY * state.scale;
        drawFrame(state);
      }, { passive: false });

      resetBtn.addEventListener('click', () => fitCover(state));
      exportPngBtn.addEventListener('click', () => exportPNG(state));

      ['dragenter', 'dragover'].forEach((ev) => preview.addEventListener(ev, (e) => {
        e.preventDefault();
        dropHint.textContent = 'Loslassen zum Laden…';
      }));
      ['dragleave', 'dragend', 'drop'].forEach((ev) => preview.addEventListener(ev, (e) => {
        e.preventDefault();
        dropHint.textContent = 'Bild hierher ziehen oder klicken';
      }));
      preview.addEventListener('drop', (e) => {
        const file = e.dataTransfer.files && e.dataTransfer.files[0];
        if (!file) return;
        fileInput.files = e.dataTransfer.files;
        fileInput.dispatchEvent(new Event('change'));
      });

      return state;
    });

    let img = null;
    let naturalW = 0;
    let naturalH = 0;

    function setScale(state, nextScale) {
      const min = parseFloat(state.zoom.min);
      const max = parseFloat(state.zoom.max);
      state.scale = Math.min(max, Math.max(min, nextScale));
      state.zoom.value = String(state.scale);
      state.zoomLabel.textContent = state.scale.toFixed(2) + '×';
    }

    function drawFrame(state) {
      const { ctx, canvas } = state;
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      if (img) {
        const cx = canvas.width / 2 + state.offsetX;
        const cy = canvas.height / 2 + state.offsetY;
        const drawW = naturalW * state.scale;
        const drawH = naturalH * state.scale;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(img, cx - drawW / 2, cy - drawH / 2, drawW, drawH);
      }
      ctx.lineWidth = 4;
      ctx.strokeStyle = '#222';
      ctx.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
    }

    function drawAll() {
      frameStates.forEach(drawFrame);
    }

    function fitCover(state) {
      if (!img) return;
      state.coverScale = Math.max(state.px.w / naturalW, state.px.h / naturalH);
      setScale(state, state.coverScale);
      state.offsetX = 0;
      state.offsetY = 0;
      drawFrame(state);
    }

    function ensureImageLoaded() {
      if (!img) {
        alert('Bitte zuerst ein Bild laden.');
        return false;
      }
      return true;
    }

    function exportPNG(state) {
      if (!ensureImageLoaded()) return;
      const url = state.canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = `maske-${state.mm.w}x${state.mm.h}mm.png`;
      a.click();
    }

    function addCropMarks(pdf, x, y, w, h) {
      const m = 4;
      pdf.line(x - m, y, x, y); pdf.line(x, y - m, x, y);
      pdf.line(x + w, y - m, x + w, y); pdf.line(x + w, y, x + w + m, y);
      pdf.line(x - m, y + h, x, y + h); pdf.line(x, y + h, x, y + h + m);
      pdf.line(x + w, y + h, x + w + m, y + h); pdf.line(x + w, y + h, x + w, y + h + m);
    }

    function exportAllPDF() {
      if (!ensureImageLoaded()) return;
      try {
        const { jsPDF } = window.jspdf || {};
        if (!jsPDF) throw new Error('jsPDF nicht geladen');
        const pdf = new jsPDF({ unit: 'mm', format: 'a4' });
        const pageW = pdf.internal.pageSize.getWidth();
        const pageH = pdf.internal.pageSize.getHeight();
        const spacing = 12;
        let cursorY = 20;

        frameStates.forEach((state, index) => {
          const { w, h } = state.mm;
          if (cursorY + h > pageH - 10 && index !== 0) {
            pdf.addPage();
            cursorY = 20;
          }
          const x = (pageW - w) / 2;
          const imgData = state.canvas.toDataURL('image/jpeg', 0.95);
          pdf.setDrawColor(150);
          pdf.setLineWidth(0.2);
          addCropMarks(pdf, x, cursorY, w, h);
          pdf.addImage(imgData, 'JPEG', x, cursorY, w, h);
          cursorY += h + spacing;
        });

        pdf.save('masken-alle.pdf');
      } catch (e) {
        alert('PDF-Export fehlgeschlagen: ' + e.message);
        console.error(e);
      }
    }

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        img = new Image();
        img.onload = () => {
          naturalW = img.naturalWidth;
          naturalH = img.naturalHeight;
          frameStates.forEach((state) => {
            state.coverScale = Math.max(state.px.w / naturalW, state.px.h / naturalH);
            const minS = 0.5 * state.coverScale;
            const maxS = 4 * state.coverScale;
            state.zoom.min = String(minS);
            state.zoom.max = String(maxS);
            state.zoom.step = String(Math.max((maxS - minS) / 200, 0.0005));
            setScale(state, state.coverScale);
            state.offsetX = 0;
            state.offsetY = 0;
            if (state.dropHint) {
              state.dropHint.style.display = 'none';
            }
          });
          exportAllPdfBtn.disabled = false;
          drawAll();
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    frameStates.forEach((state) => setScale(state, parseFloat(state.zoom.value)));
    drawAll();
    exportAllPdfBtn.addEventListener('click', exportAllPDF);
  </script>

  <!--
  ▸ Deployment auf GitHub Pages
  1) Neues Repo (z.B. santa3d/bild-maske-55x71)
  2) Diese Datei als index.html ins Repo legen, commit & push
  3) In den Repository-Einstellungen → Pages → Branch: main (root) auswählen
  4) Nach Bereitstellung unter https://<user>.github.io/<repo>/ erreichbar
  -->
</body>
</html>
